## 8515项目说明


## 项目结构

###Arena
    赛场相关的配置。
    目前仅用在自动阶段的自动驾驶功能中。
    将来考虑进行识别定位时，提供赛场相关的数据。
        ArenaMap是目前使用的。
        其中SPEED_MS_PER_INCH，用于计算自动导航阶段，行驶可能需要的最大时间。尚未做精准调教。
        DRIVE_SPEED 为自动导航时的行进速度。目前使用了编码器，0.3意思为马达标定最高速度的30%。
        robotTurnDistance，为转90度时，左右轮需要行进的里程，单位英寸。
        cruisePoints 为自动导航阶段，4个出发点出发后，要分段行驶的路径。
            CruiseSegment的参数为：速度、左轮行进里程、右轮行进里程、最大时间。
            左右轮数值同为正值时为前进，同负时为退，左正右负为左转，右正左负为右转。
            机器人收块方向为前进方向。
            b1为蓝方1号出发位置。
            b2为蓝方2号出发位置。
            r1为红方1号出发位置。
            r2为红方2号出发位置。
          
        目前r1路径经过测试可以成功将块放入密码箱。
        其他3个还需要再测试。
        b1和r1的前进是相反的。
        
        
        

###HardWare
    HardwareBotGulosity
    饕餮版。。。前吞后吐。
    在自动阶段调试过程中，此类中的部分代码被放弃。
    
    软件与硬件的匹配都在常量中。
    常量后附带的类似“//h2m0”的注释，代表当前设备所在端口。
        h1代表1号盒子
        m0代表0号马达位
        s0代表0号伺服位
        i0代表0号i2c位
    
    常量中，有部分在最新版功能中不再使用。
    请注意如需调试，从opMode程序中查看调用了Hardware的那个方法里是否使用。
    少量常量为便于调试暂时设置为public，将来可能封装后取消public
    
    常量中伺服位置，通常有INIT、READY等状态
        INIT通常为上电初始化时的位置
        READY通常为需要执行功能时的位置
        
    driveByEncoder 是自动阶段使用的主要自动导航功能。
        功能为根据左右轮指定的行驶距离和最大时间，通过RUN_TO_POSITION以编码器进行自动巡航。
    driveByStick   是手动阶段使用的主要自动导航功能。
        （driveByStick1为测试版功能，可以忽略）
        三个核心参数中
        xOffset 决定了平移速度
        yOffset 决定了前进后退速度
        yawOffset 决定了旋转速度
        目前的逻辑为优先考虑旋转，然后前进后退，最后旋转速度
        
        4个电机的速度值
        进退：同正前进，同负后退
        旋转：一边正一边负
        平移：一边内旋、一边外旋
        
        一般stick推到顶是1或-1，所以使用driveSpeedScale做数值收缩，以降低速度。
        driveSpeedHigh：高速版，0.4。
        driveSpeedSlow：低速版，0.1。
        
 
## 手动阶段
    PushbotTeleopGulosity
    单手柄操控，1号手柄位。
    手机中选择手动opMode中的“Gulosity: Manually”
        left_stick_x       左右转向
        left_stick_y       前后行动
        right_stick_y      左右平移
        y       调节动力为高速，x 调节动力为低速
        b       推送方块
        a       平台设置为水平状态
        right_bumper left_bumper 控制吸块
        dpad_left dpad_right 平台翻转
        dpad_up dpad_down   平台抬升
        
    运行中的具体数值，可通过查阅调用robot中方法里设定的常量值来进行调控。

## 自动阶段
    FtcPhaseAutoGulosity
    自动阶段逻辑大部分在此文件中重写。
    自动阶段大部分参数，都保存在HardwareBotGulosity中。
    从自动阶段调用的robot方法中，查找相关常量数值并进行调校。

    陀螺仪辅助提高自动驾驶精度的方法。
        首先考虑使用REV内建的IMU来获取角度变化，在自动驾驶过程中，根据角度变化，对左右侧轮进行补偿，以矫正行进和转向路线。
        遇到的问题：实际使用中发现IMU的获取速度和数据精度都存在很大问题。具体表现在：
            使用IMU获取当前角度和初始角度差的时候，很经常出现IMU当前值变化不连续的现象，极端情况曾出现角度从30度直接跳到110的情况。
            使用IMU获取当前角度性能较差，经实际检测，每秒循环次数只有几十次。
        由于FTC场地自动阶段的行进路线基本都很短，上述2个问题叠加之后的结果就是，机器人极其容易出现角度过度矫正的情况。
        